tests:
  - description: "Root project is multiplatform, hence it has tasks concerning all platforms"
    configuration:
      tasks: ":tasks"
      options:
        - "--stacktrace"
    expectation:
      success: ':tasks'
      output_contains:
        - "Tasks runnable from root project 'test0'"
        # build
        - "allMetadataJar - Assembles a jar archive containing the metadata for all Kotlin source sets."
        - "assemble - Assembles the outputs of this project."
        - "assembleJsPackage - Assembles js package."
        - "jsJar - Assembles an archive containing the main classes."
        - "jsMainClasses - Assembles outputs for compilation 'main' of target 'js'"
        - "jsSourcesJar - Assembles a jar archive containing the sources of target 'js'."
        - "jsTestClasses - Assembles outputs for compilation 'test' of target 'js'"
        - "jvmJar - Assembles an archive containing the main classes."
        - "jvmMainClasses - Assembles outputs for compilation 'main' of target 'jvm'"
        - "jvmSourcesJar - Assembles a jar archive containing the sources of target 'jvm'."
        - "jvmTestClasses - Assembles outputs for compilation 'test' of target 'jvm'"
        - "kotlinSourcesJar - Assembles a jar archive containing the sources of target 'kotlin'."
        - "mainClasses - Assembles outputs for compilation 'main' of target 'js'"
        - "metadataCommonMainClasses - Assembles outputs for compilation 'commonMain' of target 'metadata'"
        - "metadataMainClasses - Assembles outputs for compilation 'main' of target 'metadata'"
        - "metadataSourcesJar - Assembles a jar archive containing the sources of target 'metadata'."
        # documentation
        - "dokkaHtml - Generates documentation in 'html' format"
        - "dokkaHtmlMultiModule - Runs all subprojects 'dokkaHtml' tasks and generates module navigation page"
        - "dokkaHtmlMultiModuleZip"
        # dukat
        - "generateExternals - Generate Kotlin/JS external declarations for .d.ts files of all NPM dependencies in compilation 'main' (target js (js))"
        - "generateExternalsIntegrated - Integrated generation Kotlin/JS external declarations for .d.ts files in compilation 'main' (target js (js))"
        - "jsGenerateExternals - Generate Kotlin/JS external declarations for .d.ts files of all NPM dependencies in compilation 'main' (target js (js))"
        - "jsGenerateExternalsIntegrated - Integrated generation Kotlin/JS external declarations for .d.ts files in compilation 'main' (target js (js))"
        # ktlint
        - "ktlintFormat - Runs the ktlint formatter on all kotlin sources in this project."
        - "ktlintApplyToIdea - Generates IDEA built-in formatter rules and apply them to the project.It will overwrite existing ones."
        - "ktlintApplyToIdeaGlobally - Generates IDEA built-in formatter rules and apply them globally (in IDEA user settings folder). It will overwrite existing ones."
        - "ktlintGenerateBaseline - Generates KtLint baseline file"
        - "ktlintCheck - Runs ktlint on all kotlin sources in this project."
        # nodejs
        - "jsPackageJson - Create package.json file for compilation 'main' (target js (js))"
        - "jsTestPackageJson - Create package.json file for compilation 'test' (target js (js))"
        - "kotlinNodeJsSetup - Download and install a local node/npm version"
        - "kotlinNpmInstall - Find, download and link NPM dependencies and projects"
        - "kotlinYarnSetup - Download and install a local yarn version"
        - "nodeKotlinClean - Clean unused local node version"
        - "packageJson - Create package.json file for compilation 'main' (target js (js))"
        - "rootPackageJson - Create root package.json"
        - "testPackageJson - Create package.json file for compilation 'test' (target js (js))"
        # signing
        - "signAllPublications"
        - "signJavaOSSRHPublication - Signs all artifacts in the 'javaOSSRH' publication."
        - "signJsPublication - Signs all artifacts in the 'js' publication."
        - "signJvmPublication - Signs all artifacts in the 'jvm' publication."
        - "signKotlinMultiplatformPublication - Signs all artifacts in the 'kotlinMultiplatform' publication."
        - "signKotlinOSSRHPublication - Signs all artifacts in the 'kotlinOSSRH' publication."
        # maven
        - "generateMetadataFileForJavaOSSRHPublication - Generates the Gradle metadata file for publication 'javaOSSRH'."
        - "generateMetadataFileForJsPublication - Generates the Gradle metadata file for publication 'js'."
        - "generateMetadataFileForJvmPublication - Generates the Gradle metadata file for publication 'jvm'."
        - "generateMetadataFileForKotlinMultiplatformPublication - Generates the Gradle metadata file for publication 'kotlinMultiplatform'."
        - "generateMetadataFileForKotlinOSSRHPublication - Generates the Gradle metadata file for publication 'kotlinOSSRH'."
        - "generatePomFileForJavaOSSRHPublication - Generates the Maven POM file for publication 'javaOSSRH'."
        - "generatePomFileForJsPublication - Generates the Maven POM file for publication 'js'."
        - "generatePomFileForJvmPublication - Generates the Maven POM file for publication 'jvm'."
        - "generatePomFileForKotlinMultiplatformPublication - Generates the Maven POM file for publication 'kotlinMultiplatform'."
        - "generatePomFileForKotlinOSSRHPublication - Generates the Maven POM file for publication 'kotlinOSSRH'."
        - "publish - Publishes all publications produced by this project."
        - "publishAllPublicationsToMavenCentralRepository - Publishes all Maven publications produced by this project to the MavenCentral repository."
        - "publishAllPublicationsToMavenLocalRepository - Publishes all Maven publications produced by this project to the MavenLocal repository."
        - "publishJavaOSSRHPublicationToMavenCentralRepository - Publishes Maven publication 'javaOSSRH' to Maven repository 'MavenCentral'."
        - "publishJavaOSSRHPublicationToMavenLocal - Publishes Maven publication 'javaOSSRH' to the local Maven repository."
        - "publishJavaOSSRHPublicationToMavenLocalRepository - Publishes Maven publication 'javaOSSRH' to Maven repository 'MavenLocal'."
        - "publishJsPackageToCustomRegistry - Publishes NPM package to NPM registry"
        - "publishJsPublicationToMavenCentralRepository - Publishes Maven publication 'js' to Maven repository 'MavenCentral'."
        - "publishJsPublicationToMavenLocal - Publishes Maven publication 'js' to the local Maven repository."
        - "publishJsPublicationToMavenLocalRepository - Publishes Maven publication 'js' to Maven repository 'MavenLocal'."
        - "publishJvmPublicationToMavenCentralRepository - Publishes Maven publication 'jvm' to Maven repository 'MavenCentral'."
        - "publishJvmPublicationToMavenLocal - Publishes Maven publication 'jvm' to the local Maven repository."
        - "publishJvmPublicationToMavenLocalRepository - Publishes Maven publication 'jvm' to Maven repository 'MavenLocal'."
        - "publishKotlinMultiplatformPublicationToMavenCentralRepository - Publishes Maven publication 'kotlinMultiplatform' to Maven repository 'MavenCentral'."
        - "publishKotlinMultiplatformPublicationToMavenLocal - Publishes Maven publication 'kotlinMultiplatform' to the local Maven repository."
        - "publishKotlinMultiplatformPublicationToMavenLocalRepository - Publishes Maven publication 'kotlinMultiplatform' to Maven repository 'MavenLocal'."
        - "publishKotlinOSSRHPublicationToMavenCentralRepository - Publishes Maven publication 'kotlinOSSRH' to Maven repository 'MavenCentral'."
        - "publishKotlinOSSRHPublicationToMavenLocal - Publishes Maven publication 'kotlinOSSRH' to the local Maven repository."
        - "publishKotlinOSSRHPublicationToMavenLocalRepository - Publishes Maven publication 'kotlinOSSRH' to Maven repository 'MavenLocal'."
        - "publishToMavenLocal - Publishes all Maven publications produced by this project to the local Maven cache"
        # nexus
        - "closeStagingRepositoryOnMavenCentral - Closes the Nexus repository on MavenCentral."
        - "createStagingRepositoryOnMavenCentral - Creates a new Nexus staging repository on MavenCentral."
        - "dropStagingRepositoryOnMavenCentral - Drops the Nexus repo on MavenCentral. Incompatible with releasing the same repo."
        - "releaseStagingRepositoryOnMavenCentral - Releases the Nexus repo on MavenCentral. Incompatible with dropping the same repo."
        - "uploadAllPublicationsToMavenCentralNexus - Uploads all publications to a staging repository on MavenCentral."
        - "uploadJavaOSSRHToMavenCentralNexus - Uploads the JavaOSSRH publication to a staging repository on MavenCentral."
        - "uploadJsToMavenCentralNexus - Uploads the Js publication to a staging repository on MavenCentral."
        - "uploadJvmToMavenCentralNexus - Uploads the Jvm publication to a staging repository on MavenCentral."
        - "uploadKotlinMultiplatformToMavenCentralNexus - Uploads the KotlinMultiplatform publication to a staging repository on MavenCentral."
        - "uploadKotlinOSSRHToMavenCentralNexus - Uploads the KotlinOSSRH publication to a staging repository on MavenCentral."
        # npm
        - "publishJsPackageToCustomRegistry - Publishes NPM package to NPM registry"
        # detekt
        - "detekt"
        - "detektJsMain - Run detekt analysis for target js and source set main"
        - "detektJsTest - Run detekt analysis for target js and source set test"
        - "detektJvmMain - EXPERIMENTAL: Run detekt analysis for target jvm and source set main with type resolution."
        - "detektJvmTest - EXPERIMENTAL: Run detekt analysis for target jvm and source set test with type resolution."
        - "detektMain - EXPERIMENTAL: Run detekt analysis for main classes with type resolution"
        - "detektMetadataCommonMain - Run detekt analysis for target metadata and source set commonMain"
        - "detektMetadataMain - Run detekt analysis for target metadata and source set main"
        - "detektTest - EXPERIMENTAL: Run detekt analysis for test classes with type resolution"
        # verification
        - "jsNodeTest - Run all js tests inside nodejs using the builtin test framework"
        - "jsTest - Run JS tests for all platforms"
        - "jvmTest - Runs the tests of the test test run."
        - "nodeTest - Run all js tests inside nodejs using the builtin test framework"
        - "test - Runs the test suite."
        # versions
        - "printNpmVersion"
        - "printVersion"
  - description: "Print properties explanation"
    configuration:
      tasks: ":full:explainProperties"
      options:
        - "--stacktrace"
    expectation:
      success: ':full:explainProperties'
  - description: "Running :full:test should test all platforms and compile all dependencies"
    configuration:
      tasks: ":full:test"
      options:
        - "--stacktrace"
    expectation:
      success:
        - ":subproject-jvm:compileKotlin"
        - ":subproject-jvm:compileJava"
        - ":subproject-js:mainClasses"
        - ":subproject-mp:jvmMainClasses"
        - ":subproject-mp:jsMainClasses"
        - ":full:jvmMainClasses"
        - ":full:jsMainClasses"
        - ":full:jvmTestClasses"
        - ":full:jsTestClasses"
        - ":full:jvmTest"
        - ":full:jsTest"
  - description: "All sub-projects should have the same version of the rootProject"
    configuration:
      tasks: "printVersion"
      options:
        - "--stacktrace"
    expectation:
      success:
        - ":subproject-jvm:printVersion"
        - ":subproject-js:printVersion"
        - ":subproject-mp:printVersion"
        - ":subproject-other:printVersion"
        - ":printVersion"
        - ":full:printVersion"
      output_matches:
        - "^> Task :printVersion[\\s\\n\\r]+1\\.0\\.0$"
        - "^> Task :full:printVersion[\\s\\n\\r]+1\\.0\\.0$"
        - "^> Task :subproject-js:printVersion[\\s\\n\\r]+1\\.0\\.0$"
        - "^> Task :subproject-jvm:printVersion[\\s\\n\\r]+1\\.0\\.0$"
        - "^> Task :subproject-mp:printVersion[\\s\\n\\r]+1\\.0\\.0$"
        - "^> Task :subproject-other:printVersion[\\s\\n\\r]+1\\.0\\.0$"
  - description: "Metadata generation works"
    configuration:
      tasks:
        - "generateMetadataFileForJavaOSSRHPublication"
        - "generateMetadataFileForJsPublication"
        - "generateMetadataFileForJvmPublication"
        - "generateMetadataFileForKotlinMultiplatformPublication"
        - "generateMetadataFileForKotlinOSSRHPublication"
      options:
        - "--stacktrace"
    expectation:
      success:
        - ":full:generateMetadataFileForJavaOSSRHPublication"
        - ":full:generateMetadataFileForJsPublication"
        - ":full:generateMetadataFileForJvmPublication"
        - ":full:generateMetadataFileForKotlinMultiplatformPublication"
        - ":full:generateMetadataFileForKotlinOSSRHPublication"
  - description: "Upload to Maven implies sources and javadoc being generated"
    configuration:
      tasks: "publishToMavenLocal"
      options:
        - "--stacktrace"
    expectation:
      success:
        - ":subproject-jvm:publishToMavenLocal"
        - ":subproject-js:publishToMavenLocal"
        - ":subproject-mp:publishToMavenLocal"
        - ":full:publishToMavenLocal"
      # find build/.m2 -type f -wholename '*'
      file_exists:
        - name: build/.m2/repository/io/github/gciatto/full/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/full/1.0.0/full-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/full/1.0.0/full-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/full/1.0.0/full-1.0.0.jar
        - name: build/.m2/repository/io/github/gciatto/full/1.0.0/full-1.0.0.jar.asc
        - name: build/.m2/repository/io/github/gciatto/full/1.0.0/full-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/full/1.0.0/full-1.0.0.pom.asc
        #
        - name: build/.m2/repository/io/github/gciatto/full-js/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/full-js/1.0.0/full-js-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/full-js/1.0.0/full-js-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/full-js/1.0.0/full-js-1.0.0.klib
        - name: build/.m2/repository/io/github/gciatto/full-js/1.0.0/full-js-1.0.0.klib.asc
        - name: build/.m2/repository/io/github/gciatto/full-js/1.0.0/full-js-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/full-js/1.0.0/full-js-1.0.0.pom.asc
        #
        - name: build/.m2/repository/io/github/gciatto/full-jvm/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/full-jvm/1.0.0/full-jvm-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/full-jvm/1.0.0/full-jvm-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/full-jvm/1.0.0/full-jvm-1.0.0.jar
        - name: build/.m2/repository/io/github/gciatto/full-jvm/1.0.0/full-jvm-1.0.0.jar.asc
        - name: build/.m2/repository/io/github/gciatto/full-jvm/1.0.0/full-jvm-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/full-jvm/1.0.0/full-jvm-1.0.0.pom.asc
        #
        - name: build/.m2/repository/io/github/gciatto/subproject-js/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/subproject-js/1.0.0/subproject-js-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-js/1.0.0/subproject-js-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-js/1.0.0/subproject-js-1.0.0.klib
        - name: build/.m2/repository/io/github/gciatto/subproject-js/1.0.0/subproject-js-1.0.0.klib.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-js/1.0.0/subproject-js-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/subproject-js/1.0.0/subproject-js-1.0.0.pom.asc
        #
        - name: build/.m2/repository/io/github/gciatto/subproject-jvm/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/subproject-jvm/1.0.0/subproject-jvm-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-jvm/1.0.0/subproject-jvm-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-jvm/1.0.0/subproject-jvm-1.0.0.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-jvm/1.0.0/subproject-jvm-1.0.0.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-jvm/1.0.0/subproject-jvm-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/subproject-jvm/1.0.0/subproject-jvm-1.0.0.pom.asc
        #
        - name: build/.m2/repository/io/github/gciatto/subproject-mp/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/subproject-mp/1.0.0/subproject-mp-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-mp/1.0.0/subproject-mp-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-mp/1.0.0/subproject-mp-1.0.0.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-mp/1.0.0/subproject-mp-1.0.0.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-mp/1.0.0/subproject-mp-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/subproject-mp/1.0.0/subproject-mp-1.0.0.pom.asc
        #
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-js/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-js/1.0.0/subproject-mp-js-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-js/1.0.0/subproject-mp-js-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-js/1.0.0/subproject-mp-js-1.0.0.klib
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-js/1.0.0/subproject-mp-js-1.0.0.klib.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-js/1.0.0/subproject-mp-js-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-js/1.0.0/subproject-mp-js-1.0.0.pom.asc
        #
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-jvm/maven-metadata-local.xml
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-jvm/1.0.0/subproject-mp-jvm-1.0.0-sources.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-jvm/1.0.0/subproject-mp-jvm-1.0.0-sources.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-jvm/1.0.0/subproject-mp-jvm-1.0.0.jar
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-jvm/1.0.0/subproject-mp-jvm-1.0.0.jar.asc
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-jvm/1.0.0/subproject-mp-jvm-1.0.0.pom
        - name: build/.m2/repository/io/github/gciatto/subproject-mp-jvm/1.0.0/subproject-mp-jvm-1.0.0.pom.asc
